<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pagou-Jogou Volei Clube</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #000000;
      --bg-secondary: #111111;
      --bg-card: #1a1a1a;
      --text-primary: #ffffff;
      --text-muted: #888888;
      --accent: #ff6b00;
      --accent-light: #ff8533;
      --accent-dark: #cc5500;
      --danger: #ef4444;
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --sidebar-width: 240px;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: Inter, system-ui, Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
    }
    
    /* ====== LAYOUT PRINCIPAL ====== */
    .app-container {
      display: flex;
      min-height: 100vh;
    }
    
    /* ====== SIDEBAR (DESKTOP) ====== */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--bg-secondary);
      border-right: 1px solid rgba(255,255,255,0.05);
      padding: var(--spacing-lg);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      left: 0;
      top: 0;
    }
    
    .sidebar-logo {
      display: flex;
      align-items: baseline;
      gap: 4px;
      font-weight: 700;
      letter-spacing: 1px;
      font-size: 18px;
      margin-bottom: var(--spacing-xl);
      padding-bottom: var(--spacing-lg);
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .sidebar-logo .part1 { color: var(--text-primary); }
    .sidebar-logo .part2 { color: var(--accent); }
    
    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
      flex: 1;
    }
    
    .nav-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      padding: 14px 16px;
      border-radius: var(--radius-md);
      color: var(--text-muted);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
      border: none;
      background: transparent;
      width: 100%;
      text-align: left;
    }
    
    .nav-item:hover {
      background: rgba(255, 107, 0, 0.1);
      color: var(--text-primary);
    }
    
    .nav-item.active {
      background: rgba(255, 107, 0, 0.15);
      color: var(--accent);
      border-left: 3px solid var(--accent);
    }
    
    .nav-item .icon {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }
    
    /* ====== CONTE√öDO PRINCIPAL ====== */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      padding: var(--spacing-xl);
      min-height: 100vh;
    }
    
    .page {
      display: none;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .page.active {
      display: block;
    }
    
    .page-header {
      margin-bottom: var(--spacing-xl);
    }
    
    .page-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
    }
    
    .page-subtitle {
      color: var(--text-muted);
      font-size: 14px;
    }
    
    /* ====== CARDS ====== */
    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: var(--spacing-md);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    /* ====== FORMUL√ÅRIO ====== */
    .form-group {
      margin-bottom: var(--spacing-md);
    }
    
    .form-label {
      display: block;
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: var(--spacing-xs);
    }
    
    input, select {
      width: 100%;
      height: 48px;
      padding: 12px 14px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.03);
      color: var(--text-primary);
      font-size: 15px;
      transition: border-color 0.2s;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    input::placeholder {
      color: var(--text-muted);
    }
    
    select {
      appearance: none;
      cursor: pointer;
    }
    
    select option {
      background: var(--bg-card);
      color: var(--text-primary);
    }
    
    /* ====== BOT√ïES ====== */
    .btn {
      height: 48px;
      padding: 12px 20px;
      border-radius: var(--radius-md);
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      color: #000;
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, var(--accent-light), var(--accent));
      transform: translateY(-1px);
    }
    
    .btn-secondary {
      background: rgba(255, 107, 0, 0.15);
      border: 1px solid rgba(255, 107, 0, 0.3);
      color: var(--accent);
    }
    
    .btn-secondary:hover {
      background: rgba(255, 107, 0, 0.25);
    }
    
    .btn-danger {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: var(--danger);
    }
    
    .btn-danger:hover {
      background: rgba(239, 68, 68, 0.25);
    }
    
    .btn-block {
      width: 100%;
    }
    
    /* ====== LISTA DE CONFIRMADOS ====== */
    .contador-badge {
      background: rgba(255, 107, 0, 0.2);
      color: var(--accent);
      padding: 4px 10px;
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-weight: 600;
    }
    
    .lista-confirmados {
      list-style: none;
    }
    
    .lista-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.03);
      transition: background 0.2s;
    }
    
    .lista-item:hover {
      background: rgba(255,255,255,0.02);
    }
    
    .lista-item.avulso {
      border-left: 3px solid var(--accent);
      background: rgba(255, 107, 0, 0.03);
    }
    
    .lista-item .info {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      flex-wrap: wrap;
    }
    
    .lista-item .nome {
      font-weight: 500;
    }
    
    .lista-item.avulso .nome {
      color: var(--accent);
    }
    
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: var(--radius-sm);
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .badge-mensalista {
      background: rgba(59, 130, 246, 0.2);
      color: #60a5fa;
    }
    
    .badge-avulso {
      background: rgba(255, 107, 0, 0.2);
      color: var(--accent);
    }
    
    .badge-masculino {
      background: rgba(59, 130, 246, 0.15);
      color: #60a5fa;
    }
    
    .badge-feminino {
      background: rgba(236, 100, 155, 0.15);
      color: #ff6b9d;
    }
    
    .btn-remove {
      padding: 8px 12px;
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.2);
      border-radius: var(--radius-sm);
      color: var(--danger);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-remove:hover {
      background: rgba(239, 68, 68, 0.25);
    }
    
    /* ====== GRID DE TIMES ====== */
    .times-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-md);
    }
    
    .time-card {
      background: rgba(255,255,255,0.02);
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .time-card h4 {
      color: var(--accent);
      font-size: 15px;
      margin-bottom: var(--spacing-sm);
      padding-bottom: var(--spacing-sm);
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .time-card ul {
      list-style: none;
    }
    
    .time-card li {
      font-size: 14px;
      padding: 6px 0;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-whatsapp {
      background: rgba(37, 211, 102, 0.15);
      border: 1px solid rgba(37, 211, 102, 0.3);
      color: #25d366;
    }
    
    .btn-whatsapp:hover {
      background: rgba(37, 211, 102, 0.25);
    }
    
    /* ====== ESTAT√çSTICAS ====== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }
    
    .stat-card {
      background: rgba(255,255,255,0.02);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      text-align: center;
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .stat-value {
      font-size: 36px;
      font-weight: 700;
      color: var(--accent);
    }
    
    .stat-label {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: var(--spacing-xs);
    }
    
    .ranking-list {
      list-style: none;
    }
    
    .ranking-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.03);
    }
    
    .ranking-item .pos {
      width: 30px;
      height: 30px;
      background: rgba(255, 107, 0, 0.15);
      color: var(--accent);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 13px;
      margin-right: var(--spacing-md);
    }
    
    .ranking-item .pos.top-3 {
      background: var(--accent);
      color: #000;
    }
    
    .ranking-item .count {
      color: var(--text-muted);
      font-size: 14px;
    }
    
    /* ====== BOTTOM NAV (MOBILE) ====== */
    .bottom-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-secondary);
      border-top: 1px solid rgba(255,255,255,0.05);
      padding: var(--spacing-sm) 0;
      z-index: 1000;
    }
    
    .bottom-nav-items {
      display: flex;
      justify-content: space-around;
      align-items: center;
    }
    
    .bottom-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 16px;
      color: var(--text-muted);
      text-decoration: none;
      font-size: 11px;
      font-weight: 500;
      border: none;
      background: transparent;
      cursor: pointer;
      transition: color 0.2s;
    }
    
    .bottom-nav-item .icon {
      font-size: 22px;
    }
    
    .bottom-nav-item.active {
      color: var(--accent);
    }
    
    /* ====== MENSAGEM ====== */
    .mensagem {
      text-align: center;
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-md);
      border-radius: var(--radius-md);
      font-size: 14px;
      min-height: 20px;
    }
    
    .mensagem.sucesso {
      background: rgba(52, 211, 153, 0.1);
      color: #34d399;
    }
    
    .mensagem.erro {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
    }
    
    /* ====== RESPONSIVE ====== */
    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }
      
      .main-content {
        margin-left: 0;
        padding: var(--spacing-md);
        padding-bottom: 100px;
      }
      
      .bottom-nav {
        display: block;
      }
      
      .page-title {
        font-size: 22px;
      }
      
      .times-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    /* ====== MODAL LOGIN ====== */
    .login-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }
    .login-modal.ativo { display: flex; }
    .login-box {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 30px;
      max-width: 350px;
      width: 90%;
      border: 1px solid rgba(255, 107, 0, 0.3);
    }
    .login-box h3 {
      color: var(--accent);
      margin-bottom: 20px;
      text-align: center;
    }
    .login-box input {
      width: 100%;
      margin-bottom: 12px;
    }
    .login-erro {
      color: var(--danger);
      font-size: 13px;
      margin-bottom: 12px;
      text-align: center;
      display: none;
    }
    
    /* ====== LAB BADGE ====== */
    .lab-indicator {
      display: none;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar Desktop -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <span class="part1">PAGOU</span>
        <span class="part2">JOGOU</span>
      </div>
      
      <nav class="sidebar-nav">
        <button class="nav-item active" data-page="confirmados">
          <span class="icon">üìã</span>
          <span>Confirmados</span>
        </button>
        <button class="nav-item" data-page="sorteio">
          <span class="icon">üé≤</span>
          <span>Sorteio</span>
        </button>
        <button class="nav-item" data-page="estatisticas">
          <span class="icon">üìä</span>
          <span>Estat√≠sticas</span>
        </button>
      </nav>
    </aside>
    
    <!-- Conte√∫do Principal -->
    <main class="main-content">
      <!-- P√°gina: Confirmados -->
      <section id="page-confirmados" class="page active">
        <div class="page-header">
          <h1 class="page-title">Lista de Presen√ßa</h1>
          <p class="page-subtitle">Confirme sua presen√ßa para o v√¥lei</p>
        </div>
        
        <div class="card">
          <h3 class="card-title">‚ûï Nova Confirma√ß√£o</h3>
          <form id="formConfirma">
            <div class="form-group">
              <label class="form-label">Nome</label>
              <input type="text" id="nome" placeholder="Digite seu nome" required />
            </div>
            <div class="form-group">
              <label class="form-label">G√™nero</label>
              <select id="genero" required>
                <option value="">Selecione</option>
                <option value="masculino">Masculino</option>
                <option value="feminino">Feminino</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Tipo</label>
              <select id="tipo" required>
                <option value="">Selecione</option>
                <option value="mensalista">Mensalista</option>
                <option value="avulso">Avulso</option>
              </select>
            </div>
            <button class="btn btn-primary btn-block" type="submit">Confirmar Presen√ßa</button>
          </form>
        </div>
        
        <div id="mensagem" class="mensagem"></div>
        
        <div class="card">
          <h3 class="card-title">
            üë• Confirmados
            <span class="contador-badge" id="contadorConfirmados">0</span>
          </h3>
          <button class="btn btn-danger" id="limparConfirmados" style="margin-bottom: 16px;">üóëÔ∏è Limpar Lista</button>
          <ul class="lista-confirmados" id="listaConfirmados"></ul>
        </div>
      </section>
      
      <!-- P√°gina: Sorteio -->
      <section id="page-sorteio" class="page">
        <div class="page-header">
          <h1 class="page-title">Sorteio de Times</h1>
          <p class="page-subtitle">Distribua os jogadores em times equilibrados</p>
        </div>
        
        <div class="card">
          <h3 class="card-title">üé≤ Realizar Sorteio</h3>
          <p style="color: var(--text-muted); margin-bottom: 16px; font-size: 14px;">
            O sorteio distribui automaticamente os jogadores em 4 times, equilibrando homens e mulheres.
          </p>
          <div style="display: flex; gap: 12px;">
            <button class="btn btn-primary" style="flex:1" id="sortearTimes">Sortear Times</button>
            <button class="btn btn-danger" id="limparSorteio" style="display:none;">üóëÔ∏è Limpar</button>
          </div>
        </div>
        
        <div id="resultadoSorteio"></div>
      </section>
      
      <!-- P√°gina: Estat√≠sticas -->
      <section id="page-estatisticas" class="page">
        <div class="page-header">
          <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
            <div>
              <h1 class="page-title">Estat√≠sticas</h1>
              <p class="page-subtitle">Acompanhe as presen√ßas ao longo do tempo</p>
            </div>
            <div id="adminControls">
              <button class="btn btn-secondary" id="btnLogin" onclick="abrirLogin()">üîê Admin</button>
              <button class="btn btn-danger" id="btnLogout" onclick="fazerLogout()" style="display:none;">Sair</button>
            </div>
          </div>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="statTotal">0</div>
            <div class="stat-label">Total de Presen√ßas</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statJogadores">0</div>
            <div class="stat-label">Jogadores √önicos</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statMensalistas">0</div>
            <div class="stat-label">Mensalistas</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statAvulsos">0</div>
            <div class="stat-label">Avulsos</div>
          </div>
        </div>
        
        <div class="card">
          <h3 class="card-title">üèÜ Ranking de Presen√ßas</h3>
          <ul class="ranking-list" id="rankingList"></ul>
        </div>
      </section>
    </main>
    
    <!-- Modal de Login Admin -->
    <div class="login-modal" id="loginModal">
      <div class="login-box">
        <h3>üîê Login Admin</h3>
        <div class="login-erro" id="loginErro"></div>
        <input type="text" id="loginUsuario" placeholder="Usu√°rio">
        <input type="password" id="loginSenha" placeholder="Senha">
        <button class="btn btn-primary btn-block" onclick="fazerLogin()">Entrar</button>
        <button class="btn btn-secondary btn-block" onclick="fecharLogin()" style="margin-top:8px;">Cancelar</button>
      </div>
    </div>
    
    <!-- Bottom Nav Mobile -->
    <nav class="bottom-nav">
      <div class="bottom-nav-items">
        <button class="bottom-nav-item active" data-page="confirmados">
          <span class="icon">üìã</span>
          <span>Confirmados</span>
        </button>
        <button class="bottom-nav-item" data-page="sorteio">
          <span class="icon">üé≤</span>
          <span>Sorteio</span>
        </button>
        <button class="bottom-nav-item" data-page="estatisticas">
          <span class="icon">üìä</span>
          <span>Estat√≠sticas</span>
        </button>
      </div>
    </nav>
  </div>

  <script>
    // ====== NAVEGA√á√ÉO ======
    const navItems = document.querySelectorAll('[data-page]');
    const pages = document.querySelectorAll('.page');
    
    function navigateTo(pageId) {
      // Atualiza p√°ginas
      pages.forEach(p => p.classList.remove('active'));
      document.getElementById('page-' + pageId).classList.add('active');
      
      // Atualiza nav items
      navItems.forEach(item => {
        item.classList.toggle('active', item.dataset.page === pageId);
      });
      
      // Carrega dados espec√≠ficos da p√°gina
      if (pageId === 'estatisticas') {
        carregarEstatisticas();
      }
    }
    
    navItems.forEach(item => {
      item.addEventListener('click', () => navigateTo(item.dataset.page));
    });
    
    // ====== API ======
    function atualizarLista() {
      fetch('/confirmados')
        .then(res => res.json())
        .then(data => {
          let confirmed = Array.isArray(data) ? data.slice(0, 24) : (data.confirmed || []);
          
          document.getElementById('contadorConfirmados').textContent = confirmed.length;
          
          const ul = document.getElementById('listaConfirmados');
          ul.innerHTML = '';
          
          confirmed.forEach((c, i) => {
            const li = document.createElement('li');
            li.className = 'lista-item' + (c.tipo === 'avulso' ? ' avulso' : '');
            
            const info = document.createElement('div');
            info.className = 'info';
            
            const nome = document.createElement('span');
            nome.className = 'nome';
            nome.textContent = `${i + 1}. ${c.nome}`;
            info.appendChild(nome);
            
            const tipoBadge = document.createElement('span');
            tipoBadge.className = `badge badge-${c.tipo}`;
            tipoBadge.textContent = c.tipo === 'mensalista' ? 'M' : 'A';
            info.appendChild(tipoBadge);
            
            if (c.genero) {
              const generoBadge = document.createElement('span');
              generoBadge.className = `badge badge-${c.genero}`;
              generoBadge.textContent = c.genero === 'masculino' ? '‚ôÇ' : '‚ôÄ';
              info.appendChild(generoBadge);
            }
            
            li.appendChild(info);
            
            const btn = document.createElement('button');
            btn.className = 'btn-remove';
            btn.textContent = '‚úï';
            btn.onclick = () => removerConfirmado(c.id);
            li.appendChild(btn);
            
            ul.appendChild(li);
          });
        })
        .catch(err => mostrarMensagem('Erro ao carregar lista', 'erro'));
    }
    
    function removerConfirmado(id) {
      if (!confirm('Remover esta pessoa?')) return;
      fetch(`/confirmados/${id}`, { method: 'DELETE' })
        .then(res => res.json())
        .then(data => {
          if (data.sucesso) {
            mostrarMensagem('Removido com sucesso', 'sucesso');
            atualizarLista();
          } else {
            mostrarMensagem(data.erro || 'Erro ao remover', 'erro');
          }
        });
    }
    
    function mostrarMensagem(texto, tipo) {
      const el = document.getElementById('mensagem');
      el.textContent = texto;
      el.className = 'mensagem ' + tipo;
      setTimeout(() => { el.textContent = ''; el.className = 'mensagem'; }, 3000);
    }
    
    // ====== FORMUL√ÅRIO ======
    document.getElementById('formConfirma').addEventListener('submit', function(e) {
      e.preventDefault();
      const nome = document.getElementById('nome').value.trim();
      const tipo = document.getElementById('tipo').value;
      const genero = document.getElementById('genero').value;
      
      if (!nome || !tipo || !genero) return;
      
      fetch('/confirmar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nome, tipo, genero })
      })
        .then(res => res.json())
        .then(data => {
          mostrarMensagem('Presen√ßa confirmada!', 'sucesso');
          atualizarLista();
          this.reset();
        })
        .catch(() => mostrarMensagem('Erro ao confirmar', 'erro'));
    });
    
    // ====== SORTEIO ======
    function sortearTimes(confirmados) {
      confirmados = (confirmados || []).slice();
      confirmados.forEach(c => { if (!c.genero) c.genero = 'masculino'; });
      
      const homens = confirmados.filter(c => c.genero === 'masculino').slice();
      const mulheres = confirmados.filter(c => c.genero === 'feminino').slice();
      
      function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
      }
      shuffle(homens);
      shuffle(mulheres);
      
      const times = [[], [], [], []];
      
      for (let i = 0; i < Math.min(4, mulheres.length); i++) {
        times[i].push(mulheres[i]);
      }
      for (let i = 4; i < mulheres.length; i++) {
        times[i % 4].push(mulheres[i]);
      }
      for (let i = 0; i < homens.length; i++) {
        times[i % 4].push(homens[i]);
      }
      
      const maxSize = Math.max(...times.map(t => t.length));
      for (let i = 0; i < 4; i++) {
        while (times[i].length < maxSize) {
          times[i].push({ nome: 'Vaga Livre', genero: '', tipo: '' });
        }
      }
      
      return times;
    }
    
    document.getElementById('sortearTimes').addEventListener('click', function() {
      fetch('/confirmados')
        .then(res => res.json())
        .then(data => {
          const list = Array.isArray(data) ? data : (data.confirmed || []);
          const times = sortearTimes(list);
          
          let html = '<div class="card"><h3 class="card-title">üèê Times Sorteados</h3><div class="times-grid">';
          for (let i = 0; i < 4; i++) {
            html += `<div class="time-card"><h4>Time ${i + 1}</h4><ul>`;
            times[i].forEach(p => {
              const badge = p.genero ? `<span class="badge badge-${p.genero}">${p.genero === 'masculino' ? '‚ôÇ' : '‚ôÄ'}</span>` : '';
              html += `<li>${p.nome} ${badge}</li>`;
            });
            html += '</ul></div>';
          }
          html += '</div>';
          html += '<button class="btn btn-whatsapp btn-block" style="margin-top:16px" onclick="compartilharWhatsApp()">üì± Compartilhar no WhatsApp</button>';
          html += '</div>';
          
          document.getElementById('resultadoSorteio').innerHTML = html;
          document.getElementById('limparSorteio').style.display = 'inline-block';
          window.ultimoSorteio = times;
        });
    });
    
    document.getElementById('limparSorteio').addEventListener('click', function() {
      document.getElementById('resultadoSorteio').innerHTML = '';
      this.style.display = 'none';
      window.ultimoSorteio = null;
    });
    
    function compartilharWhatsApp() {
      if (!window.ultimoSorteio) return;
      let mensagem = '*üèê SORTEIO DOS TIMES - V√îLEI SEXTA üèê*%0A%0A';
      for (let i = 0; i < 4; i++) {
        mensagem += `*Time ${i + 1}*%0A`;
        window.ultimoSorteio[i].forEach(p => {
          mensagem += `‚Ä¢ ${p.nome}${p.genero ? ' (' + p.genero + ')' : ''}%0A`;
        });
        mensagem += '%0A';
      }
      window.open(`https://wa.me/5511986439388?text=${mensagem}`, '_blank');
    }
    
    // ====== LIMPAR LISTA ======
    document.getElementById('limparConfirmados').addEventListener('click', function() {
      if (confirm('Limpar todos os confirmados?')) {
        fetch('/confirmados', { method: 'DELETE' })
          .then(res => res.json())
          .then(data => {
            if (data.sucesso) {
              mostrarMensagem('Lista limpa!', 'sucesso');
              atualizarLista();
            }
          });
      }
    });
    
    // ====== SISTEMA ADMIN ======
    let adminToken = null;
    let isAdmin = false;
    
    function abrirLogin() {
      document.getElementById('loginModal').classList.add('ativo');
      document.getElementById('loginUsuario').focus();
    }
    
    function fecharLogin() {
      document.getElementById('loginModal').classList.remove('ativo');
      document.getElementById('loginUsuario').value = '';
      document.getElementById('loginSenha').value = '';
      document.getElementById('loginErro').style.display = 'none';
    }
    
    async function fazerLogin() {
      const usuario = document.getElementById('loginUsuario').value;
      const senha = document.getElementById('loginSenha').value;
      
      try {
        const res = await fetch('/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ usuario, senha })
        });
        const data = await res.json();
        
        if (data.sucesso) {
          adminToken = data.token;
          isAdmin = true;
          fecharLogin();
          atualizarUIAdmin();
          carregarEstatisticas();
          mostrarMensagem('Login realizado com sucesso!', 'sucesso');
        } else {
          document.getElementById('loginErro').textContent = data.erro || 'Credenciais inv√°lidas';
          document.getElementById('loginErro').style.display = 'block';
        }
      } catch (err) {
        document.getElementById('loginErro').textContent = 'Erro de conex√£o';
        document.getElementById('loginErro').style.display = 'block';
      }
    }
    
    async function fazerLogout() {
      if (adminToken) {
        try {
          await fetch('/logout', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token: adminToken })
          });
        } catch (e) {}
      }
      adminToken = null;
      isAdmin = false;
      atualizarUIAdmin();
      carregarEstatisticas();
      mostrarMensagem('Logout realizado', 'sucesso');
    }
    
    function atualizarUIAdmin() {
      document.getElementById('btnLogin').style.display = isAdmin ? 'none' : 'inline-block';
      document.getElementById('btnLogout').style.display = isAdmin ? 'inline-block' : 'none';
    }
    
    async function removerUsuarioEstatisticas(nome) {
      if (!isAdmin || !adminToken) {
        mostrarMensagem('Voc√™ precisa estar logado como admin', 'erro');
        return;
      }
      
      if (!confirm(`Remover "${nome}" das estat√≠sticas? Esta a√ß√£o n√£o pode ser desfeita!`)) return;
      
      try {
        const res = await fetch(`/estatisticas/${encodeURIComponent(nome)}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${adminToken}`
          }
        });
        const data = await res.json();
        
        if (data.sucesso) {
          mostrarMensagem(`"${nome}" removido das estat√≠sticas`, 'sucesso');
          carregarEstatisticas();
        } else {
          mostrarMensagem(data.erro || 'Erro ao remover', 'erro');
        }
      } catch (err) {
        mostrarMensagem('Erro de conex√£o', 'erro');
      }
    }
    
    // ====== ESTAT√çSTICAS ======
    function carregarEstatisticas() {
      fetch('/estatisticas')
        .then(res => res.json())
        .then(data => {
          const ranking = data.ranking || [];
          
          const total = ranking.reduce((sum, r) => sum + parseInt(r.total_confirmacoes || 0, 10), 0);
          const mensalistas = ranking.filter(r => r.tipo === 'mensalista').length;
          const avulsos = ranking.filter(r => r.tipo === 'avulso').length;
          
          document.getElementById('statTotal').textContent = total;
          document.getElementById('statJogadores').textContent = ranking.length;
          document.getElementById('statMensalistas').textContent = mensalistas;
          document.getElementById('statAvulsos').textContent = avulsos;
          
          const ul = document.getElementById('rankingList');
          ul.innerHTML = '';
          
          ranking.forEach((r, i) => {
            const li = document.createElement('li');
            li.className = 'ranking-item';
            
            const presencas = parseInt(r.total_confirmacoes || 0, 10);
            const deleteBtn = isAdmin ? `<button class="btn-remove" onclick="removerUsuarioEstatisticas('${r.nome.replace(/'/g, "\\'")}')" title="Remover">‚úï</button>` : '';
            
            li.innerHTML = `
              <div style="display:flex;align-items:center">
                <span class="pos ${i < 3 ? 'top-3' : ''}">${i + 1}</span>
                <span>${r.nome}</span>
              </div>
              <div style="display:flex;align-items:center;gap:12px;">
                <span class="count">${presencas} presen√ßas</span>
                ${deleteBtn}
              </div>
            `;
            ul.appendChild(li);
          });
        })
        .catch(() => {});
    }
    
    // ====== INIT ======
    atualizarLista();
    atualizarUIAdmin();
  </script>
</body>
</html>
